---
id: doc1
title: הטבלאות העיקריות 
sidebar_label: הטבלאות העיקריות 
slug: /
---

# 

-   **`DataFactoryRaw.dbo.LabResults` **

בטבלת חומרי הגלם. הטבלה כוללת את נתוני המעבדות כפי שנשלחו הישר מהקבצים.
הטבלה הראשונה אליה המסלול כותב את המידע.

-   **`DataFactoryOp.dbo.LabResults_STG` **

טבלת הביניים של המסלול. הטבלה אליה החומר נכתב בצורתו המטוייבת – כלומר
לאחר שעבר את הולידציות והטיובים. לאחר שלבי ההפלות וההצלבות עבור כל סגח
החומר נכתב לטבלה זו בצורת insert only כך שרשומה שהגיעה על ידי המעבדה 100
פעמים לצורך העניין, תופיע כאן 100 פעמים, בצורתה המטוייבת (עם ריפוד אפסים
למשל ועוד. *ראה ערך טיובים והפלות.*

-   **`DataFactoryMRR.dbo.LabResults`**

הטבלה המטויבת והשלמה. הטבלה אליה מגיע החומר הסופי לאחר שעבר את המסלול.
זהו הקצה של המסלול למעשה ומהשלב הזה מתחיל שלב ההנגשה. כלומר זוהי הנקודה
המשותפת של כלל לקוחות המידע, ואחריה המידע מונגש מעליה לכל לקוח בצורתו
הספציפית. למשל בטבלאות \[DataFactoryMRR\].\[dbo\].\[ LabResults\_XRM\]
עבור הXRM, כview עבור מגן אבות ועוד. בהקשרי המסלול כשאין בלבול נקרא
לטבלה הזו בקיצור MRR.

-   **`DataFactoryMRR.dbo.LabResults_SerologyKits`** 

אדם מבצע מספר בדיקות כדי לקבל תוצאת סרולוגיה (נוגדים לקורונה). המשמעות
היא שהאדם בפועל מבצע בדיקה דרך 2 (או 1 או במקרים מסויימים 3) מכשירים
שונים אשר נקראים קיטים, והחישוב של סכום שתי התוצאות של כל אחד מהקיטים
יניב את התוצאה הסופית. בטבלה LabResults שבMRR יופיעו התוצאות הסופיות
(לפעמים נקרא להם גם תוצאות סיכומיות), ובטבלה הזו יופיעו הקיטים הבודדים
(לפעמים נקרא להם גם התצאות הפרטניות). דרך הטבלה הזו נוכל לחשב תוצאות
סיכומיות עבור מעבדות שלא מחשבות בעצמן, או לאמת\\ לפסול תוצאות סיכומיות.

-   **`DataFactoryMRR.dbo.LabResults_History`**

הטבלה אשר מכילה כל שינוי שבוצע בטבלת LabResults שבMRR. ממנה רצים בעיקר
תהליכים שקשורים להנגשה לXRM. כלומר ההנגשה מבוססת על הטבלה הזו ולכן אם יש
עדכון על רשומה בMRR אך היא לא נכתבת לטבלה הזו, היא לא תונגש לXRM. בהקשרי
המסלול כאשר אין בלבול נכנה את הטבלה "היסטורי".

---

## עמודות חשובות

> העמודות אשר נתאר לרוב מופיעות
 במספר רב של טבלאות לאורך המסלול

-   **SFID**

מזהה רשומה פר הזרמה. Hash שיג'ונרט עבור כל רשומה שמגיעה ויסחב איתה מהraw
עד הmrr.

 

-   **EntityID**

הPK של LabResults - עמודת EntityId (שמורכבת מLabCode || IDNum ||
StickerNumber). אותה עמודה היא גם FK בטבלת SerologyKits וניתן לראות אותה
בעמודת MatchingFinalReultEntityId.\
הPK של SerologyKits - עמודת EntityId (שמורכבת מLabCode || IDNum ||
StickerNumber || MethodCode)

בעדכון של רשומה אנחנו לא נעדכן את הentity id. זאת מאחר וישנן מעבדות
ששולחות את אותה הבדיקה ולאחר כמה דקות עדכון שלה, בגלל שהם שלחו בפעם
הראשונה תז לא תקין. עדכון באופן כללי זה דבר לגיטימי שאנחנו תומכים בו
באמצעות פעולת merge בפרוצדורות
`[DataFactoryOp].[dbo].[Merge_LabResults]`
ו\[DataFactoryOp\].\[dbo\].\[Merge\_LabResults\_SerologyKits\]. הבעיה
היא שעדכון על אחד משדות הPK יוצר בעיה שכן אנחנו מרכיבים את הentity id על
פי כן ואז הרשומה שבעדכון תגיע עם entity id אחר. בפונקציות הmerge אנחנו
עושים את הMerge לפי השדות עצמם (כלומר לפי הid, sticker, labcode ולא לפי
הentity id) ולכן אם מגיע תז עם מקף בפעם הראשונה ותז תקין בפעם השניה,
במהלך המסלול אנחנו נסדר את התז הלא ולידי כך שיעבור לצורתו הולידית. יוצא
שאנחנו מצליחים לעדכן את שתי הרשומות שהתקבלו אחת בשניה ובmrr אכן יש לנו
עדכון ולא כפילות מיותרת. הבעיה היא שהentity id הצביע רק לרשומה האחרונה
שעידכנה אותו ובניטור לצורך העניין הרשומה הראשונה הייתה נראית כמו נפילה.

הפיתרון הוא לא לעדכן entity id בmerge וכך אוכל לראות בraw את הרשומה
האחרונה שהגיע - זו שעידכנה את הרשומה בmrr, דרך הsfid (שהוא משמש כversion
id למעשה. מזהה רשומה פר הזרמה). וכן לא אפגע בצריכה של הרשומה מצד אלון
שכן לא יהיה בlab results עוד entity id חדש על אותה רשומה.

 

-   **ResultRemark**

תקין ששדה result remark יכלול טקסט – זה מהותו. בעבור בדיקות סרולוגיה אנו
נרצה שהשדה הזה יכלול את הציון של הבדיקה הסורולוגית, בעוד שבשדה result
יופיע הסיכום שלה – כלומר חיובי\\ שלילי וכו'.

 

 

**ג'ובים בטאלנד**

 

**ג'וב ראשי - LabResults\_Files\_to\_SF\_MRR קורא לג'ובים:**

-   **Read Files **

    -   קריאה של הקבצים מהכספות לפי תיקיות ובתוכן לפי קבצים, עם כתיבה
        לdata factory raw lab results, לאחר מכן עיבוד מידע וולידציות עד
        הכתיבה לdata factory op labresults stg. בדרך לstg נכתוב את
        הרשומות הרלוונטיות עבור איגום מטושים לטבלה ייעודיות מדיבי op
        וכנל על הרשומות הרלוונטיות של סרולוגיה.

-   **Swab Pooling **

    -   איגום מטושים**,** לוקחים את המידע מlab results swab pools שבop
        וממנו מצליבים עם טבלת דיגומים, עד אשר אנחונ מקבלים את הרשומות
        הרלוונטיות של האיגום כבדיקות רגילות לכל דבר, וכותבים לstg.

-   **Serology **

    -   חישוב תוצאה סיוכמית לסרולוגיה על ידי משרד הבריאות. שליפה מהטבלה
        הרלוונטית בop, וניסיון הצלבה עם קיט תואם מהרשומות שהגיעו מאותה
        ריצה או לחלופין לאחר מכן אם לא היית ההצלבה אז עם serology kits
        (כלומר קיטים מריצות קודמות), ולבסוף כתיבה לstg.

-   **Merge 1 **

    -   נבצע insert or update מstg לmrr lab reuslts עבור pcrים
        וסרולוגיה סופי.

-   **Merge 2 **

    -   נבצע insert or update מstg לmrr lab reuslts serology kits עבור
        סרולוגיה קיטים פרטניים.

-   **Retro Data Transformation**

    -   נבצע העשרת מרשם אוכלוסין, אימותי פרוטוקול סרולוגיה וכו'. העשרות
        רטרו אקטיביות
